namespace AdventOfCode2023;

public class Dec03 : ISolution
{
    public string Input { get; set; }


    public int Answer1 { get; set; }
    public int Answer2 { get; set; }
    private string[] engine;

    public Dec03()
    {
        Input = ".........426.............985.........40..........207............................841..463................................633........17.384...\r\n531&......+..........125....-..312..........#........895......998..945.....@......$.....-...33...................353.....*........*.........\r\n........................#......*...........21..727..*..../..-./.............545......80...................602......@..272.......743.........\r\n...........558.577..........486...186*925.....*....483.883.1....286...................................625..................#474.....491.....\r\n..............*.........243.................287................*............$....245............830.........793......#..........306..*......\r\n238.685.................*................#.........%........807.........28.947.................*.....705.....*....573...500*781...#..496....\r\n..................989..923.......713...539......917.................115..*.....-...........662.........-......413...........................\r\n...........=......*..........886.*.........................442......*...........398........*.............%.............636...........%......\r\n............976.413...498..../...266........796....................87.....................969.881..&.....815...........*.....279....415.....\r\n......728*..............*..............129..........670...890.....................760...=.......@.832........227.....632.212*...............\r\n..........257.....712.491....-41...........970........*....*...373........742.......*....330....................*.....................814...\r\n....................*..................415......406..441..35..../.........-..........828.........................239.....@...533*206........\r\n......687.........834......448...658...*..........&..................467*..................244.......+332....*..........35..............*...\r\n.............453.......616..*...........609.............662......672.....56........661.602*...............549.661...................141..73.\r\n.......699...*.........*...904..........................&..........*...@..............................189..........$677.......473.....*.....\r\n........*..670.........938.........267.......684...........514...211....875.........667..171.110&.426*......../...............*........29...\r\n.....164..........................*....@786.*..........646.=.........43.......885....+...=.............641.....996...........117....28......\r\n.........*921....150*....635..973............587...346*......771........&3....+....................=................................@.......\r\n......962............821....*...*...........................$....174............391+......732*177...101.....146.............555.............\r\n..........................117.965.........327.....................*../127.54.........354.....................*...37/.......&....56....656...\r\n.335.747*967..*469.................................-.....$.450..560...........553...+.......327*..........215.........950..............-....\r\n......................253%...........796.........267...946..*........&...583.-...........-......727.37........@....#....-.......337.........\r\n.............-...............-.649.........-.................316..680......*.....982..398..................961......632...718......*..%.....\r\n..........599.............876......700..617....344*138...611..........907........-...........................................*...291...209..\r\n.860...........................*......*......................850........*..............=....761...721*804...............%...33..............\r\n...*...........................61./....378........268....956..#..813@..191...610.168..216....$...............853%......826..................\r\n.757..=422.........................427..........+....%....=...................#.../..............908................@.......................\r\n.........................172.................464...........................-.....................*.......667...931...131..@.........939.....\r\n............456.....462....*.....985................801......933..464..641.874............*189..42.........................430..596...=.....\r\n..............*....%........945.@........456....*23...........*..........*.............335.........889..557#....................*...........\r\n....810.........65......382................#.532...............704......796...192....................@..........46...527......929...........\r\n...=....%..................*433...........................925.............................................30.....*................617.......\r\n.....792.......386.....................575...%859................................................................993...334*..........&......\r\n..........657.&.....&....................*.....................296.+513.............36..........267........703.............186..............\r\n......336...........443...#.....474......897.215*346.....100.....=...........+.812../......47.%....*444..&............128........-...196....\r\n705.............980......932.......*122..................*...........305..817..*......424.../.40.........193.210.736.*..../....&.512..*.....\r\n...%...............*.....................................326..615.......*.......472..*...........350*201.......*..@....681...902......330...\r\n...................907...303...........140*112.............../........93...875......339....361=.............730.............................\r\n..............540...........*...................498.170.....................*....................#...757........241...............201.......\r\n...359*42.....=.......309...561....528.....444.....*........570............................125/.379......707.......*........*285.$..........\r\n............%.........................*770.............253..*....515..926..................................=........45.946..............*...\r\n....155..573..103.24..............................@......*...179..*........275......................*...................*................134\r\n....*............*......963...........444......801...656.796.....524.84#......*433.......997.....122.500....711.......447...................\r\n..80.........992..........*............*...+..........*....................................*.................*...............$.....894...61.\r\n........183..../.......492..955....+.222....519........373....=......304........151.........691..............655......223....37......*......\r\n.........$...................&..221................859.....929.......*...398.......*......-......591.....&.............$..........134.......\r\n................960......264........./..............#..............508...@........118..449........*...907......=791.........................\r\n...........239....#.....=...........248.531...................@..................................696.......741...................50..174....\r\n.....=......*............................*.....506*809.....796.....906.....=...........17*...........51...*.......................*..*......\r\n...520...198...781....253..............957.222.....................*.....216..............513....959*....638.312........172.318......514....\r\n...............*.........*239...............*.....%.....923.........852..............414+............../.....%...104.......*.............936\r\n.....221.....116.....712...........201...346...475.........*...............&..............745....109..202...........*.......................\r\n....*............957*.....$....353...............................171....468....%..........*.........*.........906..593..592#......&316......\r\n.........232...........251....#.......%.......................$...*...........179..904.....365.....331..541..*..............................\r\n...................................856..........412..-....844.877..871....*.........../.................*....416...........810*685..776.969.\r\n.158.......@......319........681..........780.#...+...428.*............650.241....@....................................123.............*....\r\n....%....826......@....%.688*.......983../....723.........892...................270.....234....*......443...970...........*.................\r\n....................314................*.................................................*..=...588......*.....%........225...496*732.......\r\n...344+........................644......413.997....553...................................87.282..........943........866.....................\r\n..........*563....910......267..*..546........*.....*..................60.............+..........421*739.............*...251.169.605........\r\n938.....52...........*761.*....762............335....842.....................44/.......528..........................77......*.......*201....\r\n..........................597......$.....................896.....543.76.........................938./707...............8........982.........\r\n...894..195.......310*986.....=54.854...553................#.......*...*..192...127..566*768..........................*....850...*..970.....\r\n.....*..................................=...835...874...........663...65..*.....*.................*947..539.12...947.485.....*..749..*......\r\n......34.378........$............#.........*......*......922...............947.598..880........723.....*....*...@..........791........18....\r\n..165.............388..94.......863........132.184..973.*.......58.................*......226..............618.....................=........\r\n.....*.............................................@.....154.............240..34.297.......*...........429.....625...............672........\r\n......619...#............641*520.340.918............................../..@...............390......502..-..../.*.....164....789........984...\r\n.............933.....................*.....838..240..400&..........288.......196..109............*.......749...513........*.......751...*...\r\n.....709.....................881..905.........*....*.....................643..*.....@...114...608......................190..........*....993\r\n...............109...........*........368..123....98...501.....691..410-...*.126......................92........+..546...........219........\r\n..................*......18..70..296.....*..............&..987..*........235............8.............././...828...*........................\r\n.151.............551.153*..........*.....883...............*.......*833........497..287*..427.377%.428...910......448.598.....334..53..619..\r\n..........589.......................723.........832.131..705.............................#............*.................@......*...*..*.....\r\n..........*........794*686......790...............*..........192..............................970......612.546.98............942......941...\r\n....223.686..............................547...665.......396..*.....210......408.322..839.......*..557......*...+.................521.......\r\n.....*.......170...........166.....390..............100.....*..921....*.........*.....+........984....*..450..........639..../....*...296...\r\n...372..........*760...266.*...600*......999.........*...906........................#....632.......469........250.......*...422..643....@...\r\n..............-........#...911......494...*...355...159.......................848..676.................../.....*......35....................\r\n......81$.....544..67...............*.....159....*............209.747*29........./..........812.........430.232...................199*587...\r\n760.................*...#........331.................%...158...................#.....................29.................596...477...........\r\n..........%./....922...388..970...............510...68......*....590....545...621...-..977.593..889...*.........................=..879..*389\r\n....163.618.370..............................*...............946..................332....*.......&..&..837.658......................*.......\r\n.............................835.....129...566.....690.237..............#.............$.....386....36......#......411.....52..733...783.....\r\n.........670...978.84...........=......*.......991*....*....632.......957...52.......548.....&....................*.........-.*.............\r\n....920....*..*.....*...............949..............482...*......812........-...413.....201................663.286.....-......424...296*630\r\n........992...307...634.................716..287.........811.....+........4......*...413*.........896......*...........84.52................\r\n.........................253.............................................*.....459..........926..*.......446..............$.......175.......\r\n.........................*.......168-.....781*......344.........85......373..........224.....*..393.545........749%.643......-..%.....968...\r\n...*776../145...&.....140..........................*........578*........................#..45..........*............/......596..639.........\r\n415............393..................988...........878.22..............909..........284...............173...564*48.......33.............444..\r\n........259..........%.....207-........*631...........*......669*...................*...........282......%........%.....*...................\r\n.130................119.....................422......440.........461...-154........575.............$.=....329...180..576.....367............\r\n...........618...............=.../..538$.......&............493*............729..........903.........82.......................*.............\r\n.............*............541..124.........627........806*......666.703.146*...........*.%..............-.....................142........551\r\n...#..3......660.....................*........*.......................*......./164...498..............872.621....991........................\r\n174....*...............683..542*.....960.....782.....755............557../.....................#282.......#.........*409.103.......943......\r\n........231.891...........*.....782.....................*992.............492......69.......610...............+...............557......*.....\r\n............*...964.104.289..........853......691..830.......&.....................*...870.*.............77..189.310*...............583.....\r\n....449....435.*....../........732+.=.........*...*.........238...161.....688......675..*...934......................891....................\r\n...............21.......................239........430..........@....*.....@..376.......205......790........................73..334...598...\r\n......863-................474...339.....*.................765.534.116...........*..................*..........@.......513...-....%...../....\r\n.262..........#......785....*..$....915..622....440$.&416.*.............143...34..45....515#....448...........268........*..................\r\n...*..+.......844......*.142..................*...........666.......266...*......*...................236..............439......338.496...285\r\n647...393...........236.......218..........819.779...+................./.........765...................*.......292.........$......*.........\r\n..........................257....*.................274.........247...........951........................121........391....817.../...........\r\n........742..................&....98...................628....*.................%.168..........539............................701...........\r\n.......................659................................*.622...868.............=...713.357....*.298....917...781.........................\r\n.....467....382..899......*819.....952*388..............684.......*.....................*.....558...%....%...............$..*.....60..615...\r\n.....*.....*.......*............-..........604.................85.76....%893.866.&...784.....................$423.....334....935..*....*....\r\n..154....424......583.......8....926...$............$441.....................*...50...............=....155.......................599..115...\r\n.............%............-...........96.506..846.................152.....985..........589.......384...@...44...............560.............\r\n.............161...%167..906..901.........*......&....92..+610.......*247.............*...................*...........330..*....92..........\r\n....26.........................*...........523........*......................190...711.......*..........302.690.........*.986........714@...\r\n........154.....................763..59..............305..560...726......79...*...........521.160..159................81....................\r\n991.339*........-.........434..........*....................-..*.........*..626....................*..............692......+................\r\n..............448.....96./...........782............353........949.....655...............752.522....905...964#......-.683..83...............\r\n.......=..........127../.........$....................../.......................................*......................+.........671........\r\n.783..14...........*...........746....271.38............666..................513..37.....=984.824....@....$..463.................*...154....\r\n.................60..892..304............*....354*20.................99.........*..%.351............367..914.*....622...........310...*..194\r\n.../.....339............*......318..........6.................329*...*..240.....76...*...45....*..............601......+.............211....\r\n.700...../...925......616...........*56.570.$...970...751...........556..%..958.....50..*...667........63...........793.....................\r\n...............................8.........*........*......*854................*.........304........324.....%..................*.....213%.....\r\n832...............%....$.........572......303.....872.=.............822.....2...434........%..76.@......34...866.684*.......571..........756\r\n.....922........908.811......792....#.967..............432..............304......+........676......314........*..................364....#...\r\n........................=.....*.........*.......39............127.........*........27..............+.........937.172.....532*......&........\r\n....*.............156....626...667......151..../.......................776..846...*............562.....254$......../..@......297.......751..\r\n..457.213.....403*....=......................#.......656.....546%..............*.......*866......+...................954.576...........%....\r\n.........*..........227........364....752..977.231..*...........................739.610...................................*...730..#........\r\n......838......645........$692.................*....170...............906........................149.....578..470.........981.....310.......\r\n959...........*....447.................33.513...412..........784.......*....................365.....%....*..................................\r\n...../......593......*....=..965..=907...*.............................482.....................*.......915..............327...529.....425...\r\n......613.........%.490..971.-..............&542..............................695.......803.....917........446.....53...*........*455..$....\r\n...............258..................+..303+..........................517....7*....598..@....472.....224...*............903..#...............\r\n........................724...+....575........312...&.........................................*....*......628........@.....108..............\r\n.....343.374.......$....*....675...............%...371......409.....502.928.135...482.384....195...59.............144..982........787.......\r\n....*....*.......289..729..........990....................../.........+.......*..*......*...............*.@...........#.............+.......\r\n....147...613.............*534.........938....882...740.518.....994..........800.222..933...836.......260..339.=...........628.$935...../...\r\n...............726.....308.............%........*...../.+........=..../146.................*...................509..........*........593....\r\n930.........................823..............994.................................100.....857.......................708.220.184..............";
        engine = Input.Split("\r\n");
    }

    public void Solve()
    {
        Solve1();
        Solve2();
    }

    public void Solve1()
    {        
        for (int row = 0; row < engine.Count(); row++)
        {
            List<int> gearPair = new List<int>();
            for (int currentRowPos = 0; currentRowPos < engine[row].Length; currentRowPos++)
            {
                gearPair.Clear();
                int numberOfAdjcents = 0;
                // skip non symbols
                if (!(!char.IsDigit(engine[row][currentRowPos]) && engine[row][currentRowPos] != '.'))
                    continue;

                // right
                if (currentRowPos < engine[row].Length - 1 && Char.IsDigit(engine[row][currentRowPos + 1]))
                {                    
                    numberOfAdjcents++;
                    gearPair.Add(AddNumberToRight(row, currentRowPos + 1));
                }

                // to left
                if (currentRowPos > 0 && Char.IsDigit(engine[row][currentRowPos - 1]))
                {
                    gearPair.Add(AddNumberToRight(row, FindStartPosition(row, currentRowPos - 1)));
                    numberOfAdjcents++;
                }

                // check above                
                if (row > 0 && Char.IsDigit(engine[row - 1][currentRowPos]))
                {
                    gearPair.Add(AddNumberToRight(row - 1, FindStartPosition(row - 1, currentRowPos)));
                    numberOfAdjcents++;
                }

                // if no digit above - check diagonals below
                else
                {
                    if (row > 0 && Char.IsDigit(engine[row - 1][currentRowPos - 1]))
                    {
                        gearPair.Add(AddNumberToRight(row - 1, FindStartPosition(row - 1, currentRowPos - 1)));
                        numberOfAdjcents++;
                    }
                    if (row > 0 && Char.IsDigit(engine[row - 1][currentRowPos + 1]))
                    {
                        gearPair.Add(AddNumberToRight(row - 1, currentRowPos + 1));
                        numberOfAdjcents++;
                    }
                }

                // check below
                if (row < engine.Count() - 1 && Char.IsDigit(engine[row + 1][currentRowPos]))
                {
                    gearPair.Add(AddNumberToRight(row + 1, FindStartPosition(row + 1, currentRowPos)));
                    numberOfAdjcents++;
                }

                // if no digit below, check diagonals below
                else
                {
                    if (row < engine.Count() - 1 && Char.IsDigit(engine[row + 1][currentRowPos - 1]))
                    {
                        gearPair.Add(AddNumberToRight(row + 1, FindStartPosition(row + 1, currentRowPos - 1)));
                        numberOfAdjcents++;
                    }
                    if (row < engine.Count() - 1 && Char.IsDigit(engine[row + 1][currentRowPos + 1]))
                    {
                        gearPair.Add(AddNumberToRight(row + 1, currentRowPos + 1));
                        numberOfAdjcents++;
                    }
                }

                if (engine[row][currentRowPos] == '*' && numberOfAdjcents == 2)
                {
                    Answer2 += gearPair[0] * gearPair[1];
                }
            }
        }

        Console.WriteLine("First: \t" + Answer1);
    }

    private int FindStartPosition(int row, int currentRowPos)
    {
        while (currentRowPos >= 0 && Char.IsDigit(engine[row][currentRowPos]))
        {
            currentRowPos--;
        }
        return ++currentRowPos;
    }

    private int AddNumberToRight(int row, int currentRowPos)
    {
        string intString = "";
        while (currentRowPos < engine[row].Length && Char.IsDigit(engine[row][currentRowPos]))
        {
            intString += engine[row][currentRowPos];
            currentRowPos++;
        }
        Answer1 += Convert.ToInt32(intString);
        return Convert.ToInt32(intString);
    }

    public void Solve2()
    {
        Console.WriteLine("Second:\t" + Answer2);
    }
}
